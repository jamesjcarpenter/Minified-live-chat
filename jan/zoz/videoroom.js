var server=null;server="http:"===window.location.protocol?"http://"+window.location.hostname+":8088/janus":"https://"+window.location.hostname+":8089/janus";var iceServers,janus=null,sfutest=null,opaqueId="videoroomtest-"+Janus.randomString(12),servers=null,serversIndex=0;null==iceServers&&(iceServers=[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:165.22.137.67:80",username:"apostles00@yahoo.com",credential:"Zero!"}]);var url=window.location.href;function getImageDirectoryByFullURL(e){return e.substr(e.lastIndexOf("/")+1)}console.log(url),console.log(url.substr(url.lastIndexOf("/")+1));for(var map=[" ",,"abc","def","ghi","jkl","mno","pqrs","tuv","wxyz"],v=(url=url.substr(url.lastIndexOf("/")+1)).toLowerCase(),out=[],i=0;i<v.length;i++)for(var j=0;j<map.length;j++)if(map[j]&&map[j].indexOf(v[i])>-1){out.push(j);break}console.log(out.join(""));var namePos=Math.abs(out.join("")),myroom=null;window.location.protocol,myroom=namePos,window.location.protocol,myroom=namePos;var myusername=(Math.floor(1e4*Math.random())+1e4).toString().substring(1),myid=null,mystream=null,mypvtid=null,fwd=(Math.floor(1e4*Math.random())+1e4).toString().substring(1),audioDeviceId=null,videoDeviceId=null,firstTime=!0,audioenabled=!1,videoenabled=!1,capture=null,role=null,source=null,screentest=null,feeds=[],bitrateTimer=[],doSimulcast="yes"===getQueryStringValue("simulcast")||"true"===getQueryStringValue("simulcast"),doSimulcast2="yes"===getQueryStringValue("simulcast2")||"true"===getQueryStringValue("simulcast2");function initDevices(e){$("#devices").removeClass("hide"),$("#devices").parent().removeClass("hide"),$("#choose-device").click(restartCapture);var t=$("#audio-device").val(),s=$("#video-device").val();$("#audio-device, #video-device").find("option").remove(),e.forEach(function(e){var t=e.label;null!=t&&""!==t||(t=e.deviceId);var s=$('<option value="'+e.deviceId+'">'+t+"</option>");"audioinput"===e.kind?$("#audio-device").append(s):"videoinput"===e.kind?$("#video-device").append(s):"audiooutput"===e.kind&&($("#output-devices").removeClass("hide"),$("#audiooutput").append('<li><a href="#" id="'+e.deviceId+'">'+t+"</a></li>"),$("#audiooutput a").unbind("click").click(function(){var e=$(this).attr("id"),t=$(this).text();return Janus.log("Trying to set device "+e+" ("+t+") as sink for the output"),0===$("#peervideo").length?(Janus.error("No remote video element available"),bootbox.alert("No remote video element available"),!1):$("#peervideo").get(0).setSinkId?($("#peervideo").get(0).setSinkId(e).then(function(){Janus.log("Audio output device attached:",e),$("#outputdeviceset").html(t+'<span class="caret"></span>').parent().removeClass("open")}).catch(function(e){Janus.error(e),bootbox.alert(e)}),!1):(Janus.error("SetSinkId not supported"),bootbox.warn("SetSinkId not supported"),!1)}))}),$("#audio-device").val(t),$("#video-device").val(s),$("#change-devices").click(function(){if(firstTime)return firstTime=!1,void restartCapture();restartCapture()})}function restartCapture(){var e={audio:!0,video:!0};Janus.debug("Sending message ("+JSON.stringify(e)+")"),sfutest.send({message:e}),Janus.debug("Trying a createOffer too (audio/video sendrecv)");var t=$("#audio-device").val()!==audioDeviceId;audioDeviceId=$("#audio-device").val();var s=$("#video-device").val()!==videoDeviceId;videoDeviceId=$("#video-device").val(),sfutest.createOffer({media:{audio:{deviceId:{exact:audioDeviceId}},replaceAudio:t,video:{deviceId:{exact:videoDeviceId}},replaceVideo:s,data:!0},simulcast:doSimulcast,success:function(t){Janus.debug("Got SDP!"),Janus.debug(t),sfutest.send({message:e,jsep:t}),publishOwnFeed()},error:function(e){Janus.error("WebRTC error:",e),bootbox.alert("WebRTC error... "+JSON.stringify(e))}})}function checkEnter(e,t){return 13!=(t.keyCode?t.keyCode:t.which?t.which:t.charCode)||(registerUsername(),!1)}function registerUsername(){if(0===$("#username").length)$("#register").click(registerUsername),$("#username").focus();else{$("#username").attr("disabled",!0),$("#register").attr("disabled",!0).unbind("click");var e=$("#username").val();if(""===e)return $("#you").removeClass().addClass("label label-warning").html("Insert your display name (e.g., pippo)"),$("#username").removeAttr("disabled"),void $("#register").removeAttr("disabled").click(registerUsername);if(/[^a-zA-Z0-9]/.test(e))return $("#you").removeClass().addClass("label label-warning").html("Input is not alphanumeric"),$("#username").removeAttr("disabled").val(""),void $("#register").removeAttr("disabled").click(registerUsername);var t={request:"join",room:myroom,ptype:"publisher",display:e};myusername=e,sfutest.send({message:t})}}function publishOwnFeed(e){$("#publish").attr("disabled",!1).unbind("click"),$("#unpublish").attr("disabled",!1).unbind("click"),$("#unpublish").click(unpublishOwnFeed),$("#videolocal").parent().parent().unblock(),$("#videolocal").show(),Janus.listDevices(initDevices),sfutest.createOffer({media:{audioRecv:!1,videoRecv:!1,audioSend:e,videoSend:!0},simulcast:doSimulcast,simulcast2:doSimulcast2,success:function(t){Janus.debug("Got publisher SDP!"),Janus.debug(t);var s={request:"configure",audio:e,video:!0};sfutest.send({message:s,jsep:t})},error:function(t){Janus.error("WebRTC error:",t),e?publishOwnFeed(!1):(bootbox.alert("WebRTC error... "+JSON.stringify(t)),$("#publish").removeAttr("disabled").click(function(){publishOwnFeed(!0)}))}})}function toggleMute(){var e=sfutest.isAudioMuted();Janus.log((e?"Unmuting":"Muting")+" local stream..."),e?sfutest.unmuteAudio():sfutest.muteAudio(),e=sfutest.isAudioMuted(),$("#mute").html(e?"<i class='volume mute icon'>":"<i class='volume up icon'>")}function unpublishOwnFeed(){$("#unpublish").attr("disabled",!0).unbind("click");sfutest.send({message:{request:"unpublish"}}),$("#videolocal").parent().parent().block(),$("#videolocal").hide()}function newRemoteFeed(e,t,s,i){var a=null;janus.attach({plugin:"janus.plugin.videoroom",opaqueId:opaqueId,success:function(t){(a=t).simulcastStarted=!1,Janus.log("Plugin attached! ("+a.getPlugin()+", id="+a.getId()+")"),Janus.log("  -- This is a subscriber");var s={request:"join",room:myroom,ptype:"subscriber",feed:e,private_id:mypvtid};"safari"!==Janus.webRTCAdapter.browserDetails.browser||"vp9"!==i&&("vp8"!==i||Janus.safariVp8)||(i&&(i=i.toUpperCase()),toastr.warning("Publisher is using "+i+", but Safari doesn't support it: disabling video"),s.offer_video=!1),a.videoCodec=i,a.send({message:s})},error:function(e){Janus.error("  -- Error attaching plugin...",e),bootbox.alert("Error attaching plugin... "+e)},onmessage:function(e,t){Janus.debug(" ::: Got a message (subscriber) :::"),Janus.debug(e);var s=e.videoroom;if(Janus.debug("Event: "+s),void 0!==e.error&&null!==e.error)bootbox.alert(e.error);else if(null!=s&&null!=s)if("attached"===s){for(var i=1;i<6;i++)if(void 0===feeds[i]||null===feeds[i]){feeds[i]=a,a.rfindex=i;break}a.rfid=e.id,a.rfdisplay=e.display,Janus.log("Successfully attached to feed "+a.rfid+" ("+a.rfdisplay+") in room "+e.room),$("#remote"+a.rfindex).removeClass("hide").html(a.rfdisplay).show()}else if("event"===s){var n=e.substream,r=e.temporal;null==n&&null==r||(a.simulcastStarted||(a.simulcastStarted=!0,addSimulcastButtons(a.rfindex,"vp8"===a.videoCodec||"h264"===a.videoCodec)),updateSimulcastButtons(a.rfindex,n,r))}null!=t&&(Janus.debug("Handling SDP as well..."),Janus.debug(t),a.createAnswer({jsep:t,media:{audioSend:!1,videoSend:!1},success:function(e){Janus.debug("Got SDP!"),Janus.debug(e);var t={request:"start",room:myroom};a.send({message:t,jsep:e})},error:function(e){Janus.error("WebRTC error:",e),bootbox.alert("WebRTC error... "+JSON.stringify(e))}}))},webrtcState:function(e){Janus.log("Janus says this WebRTC PeerConnection (feed #"+a.rfindex+") is "+(e?"up":"down")+" now")},onlocalstream:function(e){},onremotestream:function(e){Janus.debug("Remote feed #"+a.rfindex);var t=!1;0===$("#remotevideo"+a.rfindex).length&&(t=!0,$("#videoremote"+a.rfindex).append('<video class="rounded centered" id="waitingvideo'+a.rfindex+'" width=320 height=240 />'),$("#videoremote"+a.rfindex).append('<video class="rounded centered relative hide" id="remotevideo'+a.rfindex+'" width="100%" height="100%" autoplay playsinline/>'),$("#remotevideo"+a.rfindex).bind("playing",function(){$("#waitingvideo"+a.rfindex).remove(),this.videoWidth&&$("#remotevideo"+a.rfindex).removeClass("hide").show();this.videoWidth,this.videoHeight;"firefox"===Janus.webRTCAdapter.browserDetails.browser&&setTimeout(function(){$("#remotevideo"+a.rfindex).get(0).videoWidth,$("#remotevideo"+a.rfindex).get(0).videoHeight},2e3)})),Janus.attachMediaStream($("#remotevideo"+a.rfindex).get(0),e);var s=e.getVideoTracks();null==s||0===s.length?($("#remotevideo"+a.rfindex).hide(),0===$("#videoremote"+a.rfindex+" .no-video-container").length&&$("#videoremote"+a.rfindex).append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon"></i><span class="no-video-text"></span></div>')):($("#videoremote"+a.rfindex+" .no-video-container").remove(),$("#remotevideo"+a.rfindex).removeClass("hide").show()),t&&("chrome"!==Janus.webRTCAdapter.browserDetails.browser&&"firefox"!==Janus.webRTCAdapter.browserDetails.browser&&"safari"!==Janus.webRTCAdapter.browserDetails.browser||(bitrateTimer[a.rfindex]=setInterval(function(){a.getBitrate();var e=$("#remotevideo"+a.rfindex).get(0).videoWidth,t=$("#remotevideo"+a.rfindex).get(0).videoHeight;e>0&&t>0&&$("#curres"+a.rfindex).removeClass("hide").text(e+"x"+t).hide()},1e3)))},oncleanup:function(){Janus.log(" ::: Got a cleanup notification (remote feed "+e+") :::"),$("#remotevideo"+a.rfindex).remove(),$("#waitingvideo"+a.rfindex).remove(),$("#novideo"+a.rfindex).remove(),null!==bitrateTimer[a.rfindex]&&null!==bitrateTimer[a.rfindex]&&clearInterval(bitrateTimer[a.rfindex]),bitrateTimer[a.rfindex]=null,a.simulcastStarted=!1,$("#simulcast"+a.rfindex).remove()}})}function getQueryStringValue(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}function addSimulcastButtons(e,t){var s=e;$("#remote"+s).parent().append('<div id="simulcast'+s+'" class="btn-group-vertical btn-group-vertical-xs pull-right">\t<div class"row">\t\t<div class="btn-group btn-group-xs" style="width: 100%">\t\t\t<button id="sl'+s+'-2" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to higher quality" style="width: 33%">SL 2</button>\t\t\t<button id="sl'+s+'-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to normal quality" style="width: 33%">SL 1</button>\t\t\t<button id="sl'+s+'-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to lower quality" style="width: 34%">SL 0</button>\t\t</div>\t</div>\t<div class"row">\t\t<div class="btn-group btn-group-xs hide" style="width: 100%">\t\t\t<button id="tl'+s+'-2" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 2" style="width: 34%">TL 2</button>\t\t\t<button id="tl'+s+'-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 1" style="width: 33%">TL 1</button>\t\t\t<button id="tl'+s+'-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 0" style="width: 33%">TL 0</button>\t\t</div>\t</div></div>'),$("#sl"+s+"-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (lower quality)",null,{timeOut:2e3}),$("#sl"+s+"-2").hasClass("btn-success")||$("#sl"+s+"-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl"+s+"-1").hasClass("btn-success")||$("#sl"+s+"-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl"+s+"-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),feeds[s].send({message:{request:"configure",substream:0}})}),$("#sl"+s+"-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (normal quality)",null,{timeOut:2e3}),$("#sl"+s+"-2").hasClass("btn-success")||$("#sl"+s+"-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl"+s+"-1").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#sl"+s+"-0").hasClass("btn-success")||$("#sl"+s+"-0").removeClass("btn-primary btn-info").addClass("btn-primary"),feeds[s].send({message:{request:"configure",substream:1}})}),$("#sl"+s+"-2").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (higher quality)",null,{timeOut:2e3}),$("#sl"+s+"-2").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#sl"+s+"-1").hasClass("btn-success")||$("#sl"+s+"-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl"+s+"-0").hasClass("btn-success")||$("#sl"+s+"-0").removeClass("btn-primary btn-info").addClass("btn-primary"),feeds[s].send({message:{request:"configure",substream:2}})}),t&&($("#tl"+s+"-0").parent().removeClass("hide"),$("#tl"+s+"-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (lowest FPS)",null,{timeOut:2e3}),$("#tl"+s+"-2").hasClass("btn-success")||$("#tl"+s+"-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl"+s+"-1").hasClass("btn-success")||$("#tl"+s+"-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl"+s+"-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),feeds[s].send({message:{request:"configure",temporal:0}})}),$("#tl"+s+"-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (medium FPS)",null,{timeOut:2e3}),$("#tl"+s+"-2").hasClass("btn-success")||$("#tl"+s+"-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl"+s+"-1").removeClass("btn-primary btn-info").addClass("btn-info"),$("#tl"+s+"-0").hasClass("btn-success")||$("#tl"+s+"-0").removeClass("btn-primary btn-info").addClass("btn-primary"),feeds[s].send({message:{request:"configure",temporal:1}})}),$("#tl"+s+"-2").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (highest FPS)",null,{timeOut:2e3}),$("#tl"+s+"-2").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#tl"+s+"-1").hasClass("btn-success")||$("#tl"+s+"-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl"+s+"-0").hasClass("btn-success")||$("#tl"+s+"-0").removeClass("btn-primary btn-info").addClass("btn-primary"),feeds[s].send({message:{request:"configure",temporal:2}})}))}function joinThis(){var e={request:"join",room:myroom,ptype:"publisher",display:myusername};sfutest.send({message:e})}function updateSimulcastButtons(e,t,s){var i=e;0===t?(toastr.success("Switched simulcast substream! (lower quality)",null,{timeOut:2e3}),$("#sl"+i+"-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl"+i+"-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl"+i+"-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===t?(toastr.success("Switched simulcast substream! (normal quality)",null,{timeOut:2e3}),$("#sl"+i+"-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl"+i+"-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#sl"+i+"-0").removeClass("btn-primary btn-success").addClass("btn-primary")):2===t&&(toastr.success("Switched simulcast substream! (higher quality)",null,{timeOut:2e3}),$("#sl"+i+"-2").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#sl"+i+"-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl"+i+"-0").removeClass("btn-primary btn-success").addClass("btn-primary")),0===s?(toastr.success("Capped simulcast temporal layer! (lowest FPS)",null,{timeOut:2e3}),$("#tl"+i+"-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl"+i+"-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl"+i+"-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===s?(toastr.success("Capped simulcast temporal layer! (medium FPS)",null,{timeOut:2e3}),$("#tl"+i+"-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl"+i+"-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl"+i+"-0").removeClass("btn-primary btn-success").addClass("btn-primary")):2===s&&(toastr.success("Capped simulcast temporal layer! (highest FPS)",null,{timeOut:2e3}),$("#tl"+i+"-2").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl"+i+"-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl"+i+"-0").removeClass("btn-primary btn-success").addClass("btn-primary"))}$(document).ready(function(){Janus.init({debug:"all",callback:function(){$("#start").one("click",function(){$(this).attr("disabled",!0).unbind("click"),Janus.isWebrtcSupported()?janus=new Janus({server:server,success:function(){janus.attach({plugin:"janus.plugin.videoroom",opaqueId:opaqueId,success:function(e){$("#details").remove(),sfutest=e,Janus.log("Plugin attached! ("+sfutest.getPlugin()+", id="+sfutest.getId()+")"),Janus.log("  -- This is a publisher/manager");var t={request:"join",room:myroom,ptype:"publisher",display:myusername};sfutest.send({message:t}),$("#containerchoose").hide(),$("#mediasettings").click(function(){$(".ui.medium.inverted.modal").modal("show"),$("#containerchoose").show()});var s={request:"listforwarders",room:myroom};sfutest.send({message:s}),$("#start").removeAttr("disabled").html("Stop").click(function(){$(this).attr("disabled",!0),janus.destroy()})},error:function(e){Janus.error("  -- Error attaching plugin...",e),bootbox.alert("Error attaching plugin... "+e)},consentDialog:function(e){Janus.debug("Consent dialog should be "+(e?"on":"off")+" now"),e?$.blockUI({message:'<div><img src="images/up_arrow.png"/></div>',css:{border:"none",padding:"15px",backgroundColor:"transparent",color:"#aaa",top:"10px",left:navigator.mozGetUserMedia?"-100px":"300px"}}):$.unblockUI()},mediaState:function(e,t){Janus.log("Janus "+(t?"started":"stopped")+" receiving our "+e)},webrtcState:function(e){Janus.log("Janus says our WebRTC PeerConnection is "+(e?"up":"down")+" now"),$("#videolocal").parent().parent().unblock(),e&&($("#bitrate").parent().parent().removeClass("hide").show(),$("#bitrate a").click(function(){var e=$(this).attr("id"),t=1e3*parseInt(e);return 0===t?Janus.log("Not limiting bandwidth via REMB"):Janus.log("Capping bandwidth to "+t+" via REMB"),$("#bitrateset").html($(this).html()+'<span class="caret"></span>').parent().removeClass("open"),sfutest.send({message:{request:"configure",bitrate:t}}),!1}))},onmessage:function(e,t){Janus.debug(" ::: Got a message (publisher) :::"),Janus.debug(e);var s=e.videoroom;if(Janus.debug("Event: "+s),null!=s&&null!=s)if("joined"===s){if(myid=e.id,mypvtid=e.private_id,Janus.log("Successfully joined room "+e.room+" with ID "+myid),mystream=null,$("#publish").click(function(){publishOwnFeed(!0)}),$("#videolocal").parent().parent().unblock(),$("#bitrate").parent().parent().addClass("hide"),$("#bitrate a").unbind("click"),void 0!==e.publishers&&null!==e.publishers){var i=e.publishers;for(var a in Janus.debug("Got a list of available publishers/feeds:"),Janus.debug(i),i){var n=i[a].id,r=i[a].display,o=i[a].audio_codec,l=i[a].video_codec;Janus.debug("  >> ["+n+"] "+r+" (audio: "+o+", video: "+l+")"),newRemoteFeed(n,r,o,l)}}}else if("destroyed"===s)Janus.warn("The room has been destroyed!"),bootbox.alert("The room has been destroyed",function(){window.location.reload()});else if("event"===s)if(void 0!==e.publishers&&null!==e.publishers){i=e.publishers;for(var a in Janus.debug("Got a list of available publishers/feeds:"),Janus.debug(i),i){n=i[a].id,r=i[a].display,o=i[a].audio_codec,l=i[a].video_codec;Janus.debug("  >> ["+n+"] "+r+" (audio: "+o+", video: "+l+")"),newRemoteFeed(n,r,o,l)}}else if(void 0!==e.leaving&&null!==e.leaving){var d=e.leaving;Janus.log("Publisher left: "+d);for(var u=null,c=1;c<6;c++)if(null!=feeds[c]&&null!=feeds[c]&&feeds[c].rfid==d){u=feeds[c];break}null!=u&&(Janus.debug("Feed "+u.rfid+" ("+u.rfdisplay+") has left the room, detaching"),$("#remote"+u.rfindex).empty().hide(),$("#videoremote"+u.rfindex).empty(),feeds[u.rfindex]=null,u.detach())}else if(void 0!==e.unpublished&&null!==e.unpublished){var m=e.unpublished;if(Janus.log("Publisher left: "+m),"ok"===m)return void sfutest.hangup();for(u=null,c=1;c<6;c++)if(null!=feeds[c]&&null!=feeds[c]&&feeds[c].rfid==m){u=feeds[c];break}null!=u&&(Janus.debug("Feed "+u.rfid+" ("+u.rfdisplay+") has left the room, detaching"),$("#remote"+u.rfindex).empty().hide(),$("#videoremote"+u.rfindex).empty(),feeds[u.rfindex]=null,u.detach())}else if(void 0!==e.error&&null!==e.error)if(426===e.error_code){var b={request:"create",room:myroom,ptype:"publisher",display:myusername};sfutest.send({message:b}),joinThis()}else bootbox.alert(e.error);if(null!=t){Janus.debug("Handling SDP as well..."),Janus.debug(t),sfutest.handleRemoteJsep({jsep:t});o=e.audio_codec;mystream&&mystream.getAudioTracks()&&mystream.getAudioTracks().length>0&&!o&&toastr.warning("Our audio stream has been rejected, viewers won't hear us");l=e.video_codec;mystream&&mystream.getVideoTracks()&&mystream.getVideoTracks().length>0&&!l&&(toastr.warning("Our video stream has been rejected, viewers won't see us"),$("#myvideo").hide(),$("#videolocal").append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon" style="height: 100%;"></i><span class="no-video-text" style="font-size: 16px;">Video rejected, no webcam</span></div>'))}},onlocalstream:function(e){Janus.debug(" ::: Got a local stream :::"),mystream=e,Janus.debug(e),$("#videojoin").hide(),$("#videos").removeClass("hide").show(),0===$("#myvideo").length&&($("#videolocal").append('<video class="rounded centered" id="myvideo" width="100%" height="100%" autoplay playsinline muted="muted"/>'),$("#videolocal").append('<button class="ui mini compact icon button" id="mute" style="position: absolute; bottom: -40px; left: 118px; margin: 15px;"><i class="volume up icon"></i></button>'),$("#mute").click(toggleMute),$("#videolocal").append('<button class="ui mini compact icon button" id="unpublish" style="position: absolute; bottom: -40px; right: 118px; margin: 15px;"><i class="times circle icon"></button>'),$("#unpublish").click(unpublishOwnFeed)),$("#publisher").removeClass("hide").html(myusername).show(),Janus.attachMediaStream($("#myvideo").get(0),e),$("#myvideo").get(0).muted="muted","completed"!==sfutest.webrtcStuff.pc.iceConnectionState&&"connected"!==sfutest.webrtcStuff.pc.iceConnectionState&&$("#videolocal").parent().parent().block({message:"<b>CAMMING UP...</b>",css:{border:"none",backgroundColor:"transparent",color:"white"}});var t=e.getVideoTracks();null==t||0===t.length?($("#myvideo").hide(),0===$("#videolocal .no-video-container").length&&$("#videolocal").append('<div class="no-video-container"><i class="camera icon"></i><span class="no-video-text">No webcam available</span></div>')):($("#videolocal .no-video-container").remove(),$("#myvideo").removeClass("hide").show())},onremotestream:function(e){},oncleanup:function(){Janus.log(" ::: Got a cleanup notification: we are unpublished now :::"),mystream=null,$("#publish").click(function(){publishOwnFeed(!0)}),$("#videolocal").parent().parent().unblock(),$("#videolocal").hide(),$("#bitrate").parent().parent().addClass("hide"),$("#bitrate a").unbind("click")}})},error:function(e){Janus.error(e),bootbox.alert(e,function(){window.location.reload()})},destroyed:function(){window.location.reload()}}):bootbox.alert("No WebRTC support... ")})}})});