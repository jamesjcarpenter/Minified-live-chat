$(function(){var t,s,e=$("#user").val(),a=0,o=0,n=0;socket.on("connect",function(){if(socket.emit("set-user-data",e),socket.on("onlineStack",function(t){$("#list").empty(),$("#list").append($("<li>").append($('<button id="ubtn" class="ui large button black"></button>').text("Group").css({"font-size":"18px"})));var s=0;for(var a in t){if(a==e)var o=$('<button class="boxF disabled"> </button>').text(a).css({"font-size":"18px"});else o=$('<button id="ubtn" class="btn btn-success  btn-md">').text(a).css({"font-size":"18px"});if("Online"==t[a]){var n=$('<span class="badge"></span>').text("*"+t[a]).css({float:"right",color:"#009933","font-size":"18px"});s++}else n=$('<span class="badge"></span>').text(t[a]).css({float:"right",color:"#a6a6a6","font-size":"18px"});$("#list").append($("<li>").append(o,n)),$("#totalOnline").text(s)}$("#scrl1").scrollTop($("#scrl1").prop("scrollHeight"))}),$("#conversation").empty(),o=0,a=0,n=0,s=$(this).text(),$("#conversation").text(s),$("#servermessage").hide(),$("#chatbox").show(),$("#datasend").hide(),"Group"==s)var t="Group-Group",i="Group-Group";else t=e+"-"+s,i=s+"-"+e;socket.emit("set-room",{name1:t,name2:i})}),socket.on("set-room",function(s){$("#conversation").empty(),$("#typing").text(""),o=0,a=0,n=0,t=s,console.log("roomId : "+t),socket.emit("old-chats-init",{room:t,username:e,msgCount:o})}),$("#scrollable").scroll(function(){0==$("#scrollable").scrollTop()&&0==a&&1==n&&($("#loading").show(),socket.emit("old-chats",{room:t,username:e,msgCount:o}))}),socket.on("old-chats",function(s){if(s.room==t){if(n=1,0!=s.result.length){$("#noChat").hide();for(var e=0;e<s.result.length;e++){var i=moment(s.result[e].createdOn).format("MMMM Do YYYY, hh:mm:ss a"),l=$('<img id="useravatar" class="ui avatar image" src="/images/avatarsmall.jpg"></img><tag id="username"name="avatar"><h6></h6></tag>').text(s.result[e].msgFrom+" : ").css({}),r=$('<span id="date" class="ui small text"></span>').text(i).css({float:"right",color:"#a6a6a6","font-size":"16px"}),c=$("<p></p>").append(l,r),p=$("<p></p>").text(s.result[e].msg).css({color:"#000000"});$("#messages").prepend($("<li>").append(c,p)),o++}console.log(o)}else $("#noChat").show(),a=1;$("#loading").hide(),o<=5&&$("#scrl2").scrollTop($("#scrl2").prop("scrollHeight"))}}),$("#datasend").keyup(function(){$("#datasend").val()?($("#sendBtn").show(),socket.emit("typing")):$("#sendBtn").hide()}),socket.on("typing",function(t){var s;clearTimeout(s),$("#typing").text(t),s=setTimeout(function(){$("#typing").text("")},3500)}),$("#datasend").submit(function(){return socket.emit("chat-msg",{msg:$("#message").val(),msgTo:s,date:Date.now()}),$("#message").val(""),$("#sendBtn").hide(),!1}),socket.on("chat-msg",function(t){var s=moment(t.date).format("MMMM Do YYYY, hh:mm:ss a"),e=$('<img id="useravatar" class="ui avatar image" src="/images/avatarsmall.jpg"></img><tag id="username"name="avatar"><h6></h6></tag>').text(t.msgFrom+" : ").css({color:"#006080"}),a=$('<span id="date" class="ui small text"></span>').text(s).css({float:"right",color:"#a6a6a6","font-size":"16px"}),n=$("<p></p>").append(e,a),i=$("<p></p>").text(t.msg).css({color:"#000000"});$("#message").append($("<li>").append(n,i)),o++,console.log(o),$("#typing").text(""),$("#scrl2").scrollTop($("#scrl2").prop("scrollHeight"))}),socket.on("disconnect",function(){$("#list").empty(),$("#messages").empty(),$("#typing").text(""),$("#frndName").text("Disconnected.."),$("#loading").hide(),$("#noChat").hide(),$("#initMsg").show().text("...Please, Refresh Your Page..."),$("#chatForm").hide(),o=0,a=0})});