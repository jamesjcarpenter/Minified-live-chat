$(document).ready(function(){var t=null;t="http:"===window.location.protocol?"http://"+window.location.hostname+":8088/janus":"https://"+window.location.hostname+":8089/janus";var s,e=null,a=null,r="streamingtest-"+Janus.randomString(12),n=null,l=null;null==s&&(s=[{urls:"stun:stun.l.google.com:19302"},{urls:"turn:165.22.137.67:80",username:"apostles00@yahoo.com",credential:"Zero!"}]);var i=!1,o=!1,c=null;function d(){$("#update-streams").unbind("click").addClass("fa-spin");var t={request:"list"};Janus.debug("Sending message ("+JSON.stringify(t)+")"),a.send({message:t,success:function(t){if(setTimeout(function(){$("#update-streams").removeClass("fa-spin").click(d)},500),null!=t){if(void 0!==t.list&&null!==t.list){$("#streams").removeClass("hide").show(),$("#streamslist").empty(),$("#watch").attr("disabled",!0).unbind("click");var s=t.list;for(var e in Janus.log("Got a list of available streams"),Janus.debug(s),s)Janus.debug("  >> ["+s[e].id+"] "+s[e].description+" ("+s[e].type+")"),$("#streamslist").append("<li><a href='#' id='"+s[e].id+"'>"+s[e].description+" ("+s[e].type+")</a></li>");$("#streamslist a").unbind("click").click(function(){return c=$(this).attr("id"),$("#streamset").html($(this).html()).parent().removeClass("open"),!1}),$("#watch").removeAttr("disabled").unbind("click").click(u)}}else bootbox.alert("Got no response to our query for available streams")}})}function u(){if(Janus.log("Selected video id #"+c),null!=c){$("#streamset").attr("disabled",!0),$("#streamslist").attr("disabled",!0),$("#watch").attr("disabled",!0).unbind("click");var t={request:"watch",id:parseInt(c)};if(a.send({message:t}),$("#stream").append('<video class="rounded centered" id="waitingvideo" width=320 height=240 />'),null==l)document.getElementById("stream")}else bootbox.alert("Select a stream from the list")}function b(){$("#watch").attr("disabled",!0).unbind("click");a.send({message:{request:"stop"}}),a.hangup(),$("#streamset").removeAttr("disabled"),$("#streamslist").removeAttr("disabled"),$("#watch").html("Watch or Listen").removeAttr("disabled").unbind("click").click(u),$("#status").empty().hide(),$("#bitrate").attr("disabled",!0),$("#bitrateset").html('Bandwidth<span class="caret"></span>'),$("#curbitrate").hide(),null!=n&&clearInterval(n),n=null,$("#curres").empty().hide(),$("#simulcast").remove(),i=!1}Janus.init({debug:"all",callback:function(){$("#start").one("click",function(){$(this).attr("disabled",!0).unbind("click"),Janus.isWebrtcSupported()?e=new Janus({server:t,success:function(){e.attach({plugin:"janus.plugin.streaming",opaqueId:r,success:function(t){$("#details").remove(),a=t,Janus.log("Plugin attached! ("+a.getPlugin()+", id="+a.getId()+")"),$("#update-streams").click(d()),$("#start").removeAttr("disabled").html("Stop").click(function(){$(this).attr("disabled",!0),e.destroy(),$("#streamslist").attr("disabled",!0),$("#watch").attr("disabled",!0).unbind("click"),$("#start").attr("disabled",!0).html("Bye").unbind("click")})},error:function(t){Janus.error("  -- Error attaching plugin... ",t),bootbox.alert("Error attaching plugin... "+t)},onmessage:function(t,s){Janus.debug(" ::: Got a message :::"),Janus.debug(t);var e=t.result;if(null!=e){if(void 0!==e.status&&null!==e.status){var r=e.status;"starting"===r?$("#status").removeClass("hide").text("Starting, please wait...").show():"started"===r?$("#status").removeClass("hide").text("Started").show():"stopped"===r&&b()}else if("event"===t.streaming){var n=e.substream,l=e.temporal;null==n&&null==l||(i||(i=!0,function(t){if($("#curres").parent().append('<div id="simulcast" class="btn-group-vertical btn-group-vertical-xs pull-right">\t<div class"row">\t\t<div class="btn-group btn-group-xs" style="width: 100%">\t\t\t<button id="sl-2" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to higher quality" style="width: 33%">SL 2</button>\t\t\t<button id="sl-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to normal quality" style="width: 33%">SL 1</button>\t\t\t<button id="sl-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to lower quality" style="width: 34%">SL 0</button>\t\t</div>\t</div>\t<div class"row">\t\t<div class="btn-group btn-group-xs hide" style="width: 100%">\t\t\t<button id="tl-2" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 2" style="width: 34%">TL 2</button>\t\t\t<button id="tl-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 1" style="width: 33%">TL 1</button>\t\t\t<button id="tl-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 0" style="width: 33%">TL 0</button>\t\t</div>\t</div></div>'),$("#sl-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (lower quality)",null,{timeOut:2e3}),$("#sl-2").hasClass("btn-success")||$("#sl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl-1").hasClass("btn-success")||$("#sl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),a.send({message:{request:"configure",substream:0}})}),$("#sl-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (normal quality)",null,{timeOut:2e3}),$("#sl-2").hasClass("btn-success")||$("#sl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#sl-0").hasClass("btn-success")||$("#sl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",substream:1}})}),$("#sl-2").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching simulcast substream, wait for it... (higher quality)",null,{timeOut:2e3}),$("#sl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#sl-1").hasClass("btn-success")||$("#sl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl-0").hasClass("btn-success")||$("#sl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",substream:2}})}),!t)return;$("#tl-0").parent().removeClass("hide"),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (lowest FPS)",null,{timeOut:2e3}),$("#tl-2").hasClass("btn-success")||$("#tl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-1").hasClass("btn-success")||$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),a.send({message:{request:"configure",temporal:0}})}),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (medium FPS)",null,{timeOut:2e3}),$("#tl-2").hasClass("btn-success")||$("#tl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-info"),$("#tl-0").hasClass("btn-success")||$("#tl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",temporal:1}})}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping simulcast temporal layer, wait for it... (highest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#tl-1").hasClass("btn-success")||$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-0").hasClass("btn-success")||$("#tl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",temporal:2}})})}(null!=l)),function(t,s){0===t?(toastr.success("Switched simulcast substream! (lower quality)",null,{timeOut:2e3}),$("#sl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===t?(toastr.success("Switched simulcast substream! (normal quality)",null,{timeOut:2e3}),$("#sl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#sl-0").removeClass("btn-primary btn-success").addClass("btn-primary")):2===t&&(toastr.success("Switched simulcast substream! (higher quality)",null,{timeOut:2e3}),$("#sl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#sl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl-0").removeClass("btn-primary btn-success").addClass("btn-primary"));0===s?(toastr.success("Capped simulcast temporal layer! (lowest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===s?(toastr.success("Capped simulcast temporal layer! (medium FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary")):2===s&&(toastr.success("Capped simulcast temporal layer! (highest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary"))}(n,l));var c=e.spatial_layer;l=e.temporal_layer,null==c&&null==l||(o||(o=!0,function(){if($("#svc").length>0)return;$("#curres").parent().append('<div id="svc" class="btn-group-vertical btn-group-vertical-xs pull-right">\t<div class"row">\t\t<div class="btn-group btn-group-xs" style="width: 100%">\t\t\t<button id="sl-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to normal resolution" style="width: 50%">SL 1</button>\t\t\t<button id="sl-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Switch to low resolution" style="width: 50%">SL 0</button>\t\t</div>\t</div>\t<div class"row">\t\t<div class="btn-group btn-group-xs" style="width: 100%">\t\t\t<button id="tl-2" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 2 (high FPS)" style="width: 34%">TL 2</button>\t\t\t<button id="tl-1" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 1 (medium FPS)" style="width: 33%">TL 1</button>\t\t\t<button id="tl-0" type="button" class="btn btn-primary" data-toggle="tooltip" title="Cap to temporal layer 0 (low FPS)" style="width: 33%">TL 0</button>\t\t</div>\t</div></div>'),$("#sl-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching SVC spatial layer, wait for it... (low resolution)",null,{timeOut:2e3}),$("#sl-1").hasClass("btn-success")||$("#sl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#sl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),a.send({message:{request:"configure",spatial_layer:0}})}),$("#sl-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Switching SVC spatial layer, wait for it... (normal resolution)",null,{timeOut:2e3}),$("#sl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#sl-0").hasClass("btn-success")||$("#sl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",spatial_layer:1}})}),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping SVC temporal layer, wait for it... (lowest FPS)",null,{timeOut:2e3}),$("#tl-2").hasClass("btn-success")||$("#tl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-1").hasClass("btn-success")||$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),a.send({message:{request:"configure",temporal_layer:0}})}),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping SVC temporal layer, wait for it... (medium FPS)",null,{timeOut:2e3}),$("#tl-2").hasClass("btn-success")||$("#tl-2").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-info"),$("#tl-0").hasClass("btn-success")||$("#tl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",temporal_layer:1}})}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary").unbind("click").click(function(){toastr.info("Capping SVC temporal layer, wait for it... (highest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-info"),$("#tl-1").hasClass("btn-success")||$("#tl-1").removeClass("btn-primary btn-info").addClass("btn-primary"),$("#tl-0").hasClass("btn-success")||$("#tl-0").removeClass("btn-primary btn-info").addClass("btn-primary"),a.send({message:{request:"configure",temporal_layer:2}})})}()),function(t,s){0===t?(toastr.success("Switched SVC spatial layer! (lower resolution)",null,{timeOut:2e3}),$("#sl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#sl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===t&&(toastr.success("Switched SVC spatial layer! (normal resolution)",null,{timeOut:2e3}),$("#sl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#sl-0").removeClass("btn-primary btn-success").addClass("btn-primary"));0===s?(toastr.success("Capped SVC temporal layer! (lowest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-info btn-success").addClass("btn-success")):1===s?(toastr.success("Capped SVC temporal layer! (medium FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-1").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary")):2===s&&(toastr.success("Capped SVC temporal layer! (highest FPS)",null,{timeOut:2e3}),$("#tl-2").removeClass("btn-primary btn-info btn-success").addClass("btn-success"),$("#tl-1").removeClass("btn-primary btn-success").addClass("btn-primary"),$("#tl-0").removeClass("btn-primary btn-success").addClass("btn-primary"))}(c,l))}}else if(void 0!==t.error&&null!==t.error)return bootbox.alert(t.error),void b();null!=s&&(Janus.debug("Handling SDP as well..."),Janus.debug(s),a.createAnswer({jsep:s,media:{audioSend:!1,videoSend:!1,data:!0},success:function(t){Janus.debug("Got SDP!"),Janus.debug(t);a.send({message:{request:"start"},jsep:t}),$("#watch").html("Stop").removeAttr("disabled").click(b)},error:function(t){Janus.error("WebRTC error:",t),bootbox.alert("WebRTC error... "+JSON.stringify(t))}}))},onremotestream:function(t){Janus.debug(" ::: Got a remote stream :::"),Janus.debug(t);var s=!1;0===$("#remotevideo").length&&(s=!0,$("#stream").append('<video class="rounded centered hide" id="remotevideo" width=320 height=240 autoplay playsinline/>'),$("#remotevideo").bind("playing",function(){$("#waitingvideo").remove(),this.videoWidth&&$("#remotevideo").removeClass("hide").show(),null!=l&&l.stop(),l=null;var s=t.getVideoTracks();if(null!=s&&0!==s.length){var e=this.videoWidth,a=this.videoHeight;$("#curres").removeClass("hide").text(e+"x"+a).show(),"firefox"===Janus.webRTCAdapter.browserDetails.browser&&setTimeout(function(){var t=$("#remotevideo").get(0).videoWidth,s=$("#remotevideo").get(0).videoHeight;$("#curres").removeClass("hide").text(t+"x"+s).show()},2e3)}})),Janus.attachMediaStream($("#remotevideo").get(0),t);var e=t.getVideoTracks();null==e||0===e.length?($("#remotevideo").hide(),0===$("#stream .no-video-container").length&&$("#stream").append('<div class="no-video-container"><i class="fa fa-video-camera fa-5 no-video-icon"></i><span class="no-video-text">No remote video available</span></div>')):($("#stream .no-video-container").remove(),$("#remotevideo").removeClass("hide").show()),s&&e&&e.length&&("chrome"===Janus.webRTCAdapter.browserDetails.browser||"firefox"===Janus.webRTCAdapter.browserDetails.browser||"safari"===Janus.webRTCAdapter.browserDetails.browser)&&($("#curbitrate").removeClass("hide").show(),n=setInterval(function(){var t=a.getBitrate();$("#curbitrate").text(t);var s=$("#remotevideo").get(0).videoWidth,e=$("#remotevideo").get(0).videoHeight;s>0&&e>0&&$("#curres").removeClass("hide").text(s+"x"+e).show()},1e3))},ondataopen:function(t){Janus.log("The DataChannel is available!"),$("#waitingvideo").remove(),$("#stream").append('<input class="form-control" type="text" id="datarecv" disabled></input>'),null!=l&&l.stop(),l=null},ondata:function(t){Janus.debug("We got data from the DataChannel! "+t),$("#datarecv").val(t)},oncleanup:function(){Janus.log(" ::: Got a cleanup notification :::"),$("#waitingvideo").remove(),$("#remotevideo").remove(),$("#datarecv").remove(),$(".no-video-container").remove(),$("#bitrate").attr("disabled",!0),$("#bitrateset").html('Bandwidth<span class="caret"></span>'),$("#curbitrate").hide(),null!=n&&clearInterval(n),n=null,$("#curres").hide(),$("#simulcast").remove(),i=!1}})},error:function(t){Janus.error(t),bootbox.alert(t,function(){window.location.reload()})},destroyed:function(){window.location.reload()}}):bootbox.alert("No WebRTC support... ")})}})});